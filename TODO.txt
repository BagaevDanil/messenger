1) После подключения к хосту нет выполнения действия, а просто подключение и стоп. Нужно либо предупреждение, либо сразу действие.
2) Если кто-то скачивает, а кто-то пишет, то новые сообщения сливаются с файлом